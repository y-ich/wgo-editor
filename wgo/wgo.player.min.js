/*! MIT license, more info: wgo.waltheri.net */(function(d,h){var l=function(n){var a=new m(JSON.parse(JSON.stringify(n.getProperties()))),c;for(c in n.children)a.appendChild(l(n.children[c]));return a},f=function(a,c){var n;if(c[a]!==h)return c[a];for(var b in c.children)if(n=f(a,c.children[b]))return n;return!1},p=function(a,c){a.push(JSON.parse(JSON.stringify(c.getProperties())));if(1<c.children.length){for(var n=[],b=0;b<c.children.length;b++){var e=[];p(e,c.children[b]);n.push(e)}a.push(n)}else c.children.length&&p(a,c.children[0])},k=function(a,
c){for(var n=c,b,e=1;e<a.length;e++)if(a[e].constructor==Array)for(var u=0;u<a[e].length;u++)b=new m(a[e][u][0]),n.appendChild(b),k(a[e][u],b);else b=new m(a[e]),n.insertAfter(b),n=b},c=function(a){return"string"==typeof a?a.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):a},e=function(a,c){return String.fromCharCode(97+a)+String.fromCharCode(97+c)},q=function(a,c,b){if(c.length){b.sgf+=a;for(var n in c)b.sgf+="["+c[n]+"]"}},g=function(a,b){if(a.move){var n="";a.move.pass||(n=e(a.move.x,a.move.y));b.sgf=
a.move.c==d.B?b.sgf+("B["+n+"]"):b.sgf+("W["+n+"]")}if(a.setup){var n=[],u=[],t=[],f;for(f in a.setup)a.setup[f].c==d.B?n.push(e(a.setup[f].x,a.setup[f].y)):a.setup[f].c==d.W?u.push(e(a.setup[f].x,a.setup[f].y)):t.push(e(a.setup[f].x,a.setup[f].y));q("AB",n,b);q("AW",u,b);q("AE",t,b)}if(a.markup){n={};for(f in a.markup)n[a.markup[f].type]=n[a.markup[f].type]||[],"LB"==a.markup[f].type?n.LB.push(e(a.markup[f].x,a.markup[f].y)+":"+c(a.markup[f].text)):n[a.markup[f].type].push(e(a.markup[f].x,a.markup[f].y));
for(var m in n)q(m,n[m],b)}f=a.getProperties();for(m in f)"object"!=typeof f[m]&&(b.sgf="turn"==m?b.sgf+("PL["+(f[m]==d.B?"B":"W")+"]"):"comment"==m?b.sgf+("C["+c(f[m])+"]"):b.sgf+(m+"["+c(f[m])+"]"));if(1==a.children.length)b.sgf+="\n;",g(a.children[0],b);else if(1<a.children.length)for(m in a.children)f=a.children[m],n=b,n.sgf+="(\n;",g(f,n),n.sgf+="\n)"},r=function(){this.size=19;this.info={};this.root=new m;this.propertyCount=this.nodeCount=0};r.prototype={constructor:r,clone:function(){var a=
new r;a.size=this.size;a.info=JSON.parse(JSON.stringify(this.info));a.root=l(this.root);a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;return a},hasComments:function(){return!!f("comment",this.root)}};r.fromSgf=function(a){return d.SGF.parse(a)};r.fromJGO=function(a){a="string"==typeof a?JSON.parse(a):a;var b=new r;b.info=JSON.parse(JSON.stringify(a.info));b.size=a.size;b.nodeCount=a.nodeCount;b.propertyCount=a.propertyCount;b.root=new m(a.game[0]);k(a.game,b.root);return b};r.prototype.toSgf=
function(){var a={sgf:"(\n;"},b={},e;for(e in this.info)"black"==e?(this.info.black.name&&(b.PB=c(this.info.black.name)),this.info.black.rank&&(b.BR=c(this.info.black.rank)),this.info.black.team&&(b.BT=c(this.info.black.team))):"white"==e?(this.info.white.name&&(b.PW=c(this.info.white.name)),this.info.white.rank&&(b.WR=c(this.info.white.rank)),this.info.white.team&&(b.WT=c(this.info.white.team))):b[e]=c(this.info[e]);this.size&&(b.SZ=this.size);b.AP||(b.AP="WGo.js:2");b.FF||(b.FF="4");b.GM||(b.GM=
"1");b.CA||(b.CA="UTF-8");for(e in b)b[e]&&(a.sgf+=e+"["+b[e]+"]");g(this.root,a);a.sgf+=")";return a.sgf};r.prototype.toJGO=function(a){var b={};b.size=this.size;b.info=JSON.parse(JSON.stringify(this.info));b.nodeCount=this.nodeCount;b.propertyCount=this.propertyCount;b.game=[];p(b.game,this.root);return a?JSON.stringify(b):b};var b=function(a){var b;a.name?(b=d.filterHTML(a.name),a.rank&&(b+=" ("+d.filterHTML(a.rank)+")"),a.team&&(b+=", "+d.filterHTML(a.team))):(a.team&&(b=d.filterHTML(a.team)),
a.rank&&(b+=" ("+d.filterHTML(a.rank)+")"));return b};r.infoFormatters={black:b,white:b,TM:function(a){if(0==a)return d.t("none");var b,c=Math.floor(a/60);1==c?b="1 "+d.t("minute"):1<c&&(b=c+" "+d.t("minutes"));c=a%60;1==c?b+=" 1 "+d.t("second"):1<c&&(b+=" "+c+" "+d.t("seconds"));return b},RE:function(a){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+d.filterHTML(a)+'\'" title="'+d.t("res-show-tip")+'">'+d.t("show")+"</a>"}};r.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");
d.Kifu=r;var a=function(a,b,c){for(var e=0;e<a.length;e++)if(a[e].x==b.x&&a[e].y==b.y){a[e][c]=b[c];return}a.push(b)},t=function(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].x==b.x&&a[c].y==b.y){a.splice(c,1);break}},m=function(a,b){this.parent=b||null;this.children=[];if(a)for(var c in a)this[c]=a[c]};m.prototype={constructor:m,getChild:function(a){a=a||0;return this.children[a]?this.children[a]:null},addSetup:function(b){this.setup=this.setup||[];a(this.setup,b,"c");return this},removeSetup:function(a){t(this.setup,
a);return this},addMarkup:function(b){this.markup=this.markup||[];a(this.markup,b,"type");return this},removeMarkup:function(a){t(this.markup,a);return this},remove:function(){var a=this.parent;if(!a)throw Error("Root node cannot be removed");for(var b in a.children)if(a.children[b]==this){a.children.splice(b,1);break}a.children=a.children.concat(this.children);this.parent=null;return a},insertAfter:function(a){for(var b in this.children)this.children[b].parent=a;a.children=a.children.concat(this.children);
a.parent=this;this.children=[a];return a},appendChild:function(a){a.parent=this;this.children.push(a);return a},getProperties:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"children"!=b&&"parent"!=b&&"_"!=b[0]&&(a[b]=this[b]);return a}};d.KNode=m;var v=function(a,b){for(var c=a.size,e=[],g=[],d=0;d<c*c;d++)a.schema[d]&&!b.schema[d]?g.push({x:Math.floor(d/c),y:d%c}):a.schema[d]!=b.schema[d]&&e.push({x:Math.floor(d/c),y:d%c,c:b.schema[d]});return{add:e,remove:g}},b=function(a,b,c){this.kifu=
a;this.node=this.kifu.root;this.allow_illegal=c||!1;this.game=new d.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.moveNumber=0;this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=d.W);this.change=w(this.game,this.node,!0);this.rememberPath=b?!0:!1},z=function(a,b){var c=[],e,d;for(d in a){e=!0;for(var g in b)if(a[d].x==b[g].x&&a[d].y==b[g].y){e=!1;break}e&&c.push(a[d])}return c},w=function(a,b,c){b.parent&&(b.parent._last_selected=
b.parent.children.indexOf(b));if(b.move!=h){if(b.move.pass)return a.pass(b.move.c),{add:[],remove:[]};a=a.play(b.move.x,b.move.y,b.move.c);if("number"==typeof a)throw new x(a,b);for(var e in a)if(a[e].x==b.move.x&&a[e].y==b.move.y)return{add:[],remove:a};return{add:[b.move],remove:a}}c||a.pushPosition();c=[];var d=[];if(b.setup!=h)for(e in b.setup)b.setup[e].c?(a.setStone(b.setup[e].x,b.setup[e].y,b.setup[e].c),c.push(b.setup[e])):(a.removeStone(b.setup[e].x,b.setup[e].y),d.push(b.setup[e]));b.turn&&
(a.turn=b.turn);return{add:c,remove:d}},y=function(a){a===h&&this.rememberPath&&(a=this.node._last_selected);a=a||0;var b=this.node.children[a];if(!b)return!1;var c=w(this.game,b);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=a);this.node=b;this.node.move&&this.moveNumber++;return c},A=function(){if(!this.node.parent)return!1;this.node.move&&this.moveNumber--;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==
h&&delete this.path[this.path.m];this.path.m--;return!0},B=function(){this.game.firstPosition();this.node=this.kifu.root;this.path={m:0};this.moveNumber=0;this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=d.W);this.change=w(this.game,this.node,!0)};b.prototype={constructor:b,next:function(a){this.change=y.call(this,a);return this},last:function(){var a;for(this.change={add:[],remove:[]};a=y.call(this);){var b=this.change;b.add=z(b.add,a.remove).concat(a.add);b.remove=z(b.remove,a.add).concat(a.remove)}return this},
previous:function(){var a=this.game.getPosition();A.call(this);this.change=v(a,this.game.getPosition());return this},first:function(){var a=this.game.getPosition();B.call(this);this.change=v(a,this.game.getPosition());return this},goTo:function(a){if(a===h)return this;var b=this.game.getPosition();B.call(this);for(var c=0;c<a.m&&y.call(this,a[c+1]);c++);this.change=v(b,this.game.getPosition());return this},previousFork:function(){for(var a=this.game.getPosition();A.call(this)&&1==this.node.children.length;);
this.change=v(a,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},allowIllegalMoves:function(a){a?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};d.KifuReader=b;var x=function(a,b){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(b.move&&b.move.c!==h&&b.move.x!==h&&b.move.y!==h){var c=b.move.x;7<b.move.x&&c++;String.fromCharCode(c+
65);this.message+="Trying to play "+(b.move.c==d.WHITE?"white":"black")+" move on "+String.fromCharCode(b.move.x+65)+""+(19-b.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(a)switch(a){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};x.prototype=
Error();x.prototype.constructor=x;d.InvalidMoveError=x;d.i18n.en.show="show";d.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(d,h){d.SGF={};var l=function(c,e,d,b,a,f){e=f==e?"black":"white";d.info[e]=d.info[e]||{};d.info[e][c]=a[0]},f=d.SGF.properties={};f.B=f.W=function(c,e,f,b){e.move=!f[0]||19>=c.size&&"tt"==f[0]?{pass:!0,c:"B"==b?d.B:d.W}:{x:f[0].charCodeAt(0)-97,y:f[0].charCodeAt(1)-97,c:"B"==b?d.B:d.W}};f.AB=f.AW=function(c,e,f,b){for(var a in f)e.addSetup({x:f[a].charCodeAt(0)-97,y:f[a].charCodeAt(1)-97,c:"AB"==b?d.B:d.W})};f.AE=function(c,e,d){for(var b in d)e.addSetup({x:d[b].charCodeAt(0)-97,y:d[b].charCodeAt(1)-
97})};f.PL=function(c,e,f){e.turn="b"==f[0]||"B"==f[0]?d.B:d.W};f.C=function(c,e,d){e.comment=d.join()};f.LB=function(c,e,d){for(var b in d)e.addMarkup({x:d[b].charCodeAt(0)-97,y:d[b].charCodeAt(1)-97,type:"LB",text:d[b].substr(3)})};f.CR=f.SQ=f.TR=f.SL=f.MA=function(c,e,d,b){for(var a in d)e.addMarkup({x:d[a].charCodeAt(0)-97,y:d[a].charCodeAt(1)-97,type:b})};f.SZ=function(c,e,d){c.size=parseInt(d[0])};f.BR=f.WR=l.bind(this,"rank","BR");f.PB=f.PW=l.bind(this,"name","PB");f.BT=f.WT=l.bind(this,"team",
"BT");f.TM=function(c,e,d,b){c.info[b]=d[0];e.BL=d[0];e.WL=d[0]};var p=/\(|\)|(;(\s*[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+)*)/g,k=/[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+/g,c=/[A-Z]+/,e=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;d.SGF.parse=function(f){var g=[],q,b,a,t=new d.Kifu,m=null;f=f.match(p);for(var h in f)if("("==f[h])g.push(m);else if(")"==f[h])m=g.pop();else{m&&t.nodeCount++;m=m?m.appendChild(new d.KNode):t.root;q=f[h].match(k)||[];t.propertyCount+=q.length;for(var l in q){a=c.exec(q[l])[0];
b=q[l].match(e);for(var w in b)b[w]=b[w].substring(1,b[w].length-1).replace(/\\(?!\\)/g,"");if(d.SGF.properties[a])d.SGF.properties[a](t,m,b,a);else 1>=b.length&&(b=b[0]),m.parent?m[a]=b:t.info[a]=b}}return t}})(WGo);(function(d){var h=function(a,b){this.name="FileError";this.message=1==b?"File '"+a+"' is empty.":2==b?"Network error. It is not possible to read '"+a+"'.":"File '"+a+"' hasn't been found on server."};h.prototype=Error();h.prototype.constructor=h;d.FileError=h;var l=d.loadFromUrl=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){if(0==c.responseText.length)throw new h(a,1);b(c.responseText)}else throw new h(a);};try{c.open("GET",a,!0),c.send()}catch(v){throw new h(a,
2);}},f=function(a){a.change&&this.board.update(a.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var b=[];this.notification();a.node.move&&this.config.markLastMove&&!this.config.displayMoveNumbers&&(a.node.move.pass?this.notification(d.t((a.node.move.c==d.B?"b":"w")+"pass")):b.push({type:"CR",x:a.node.move.x,y:a.node.move.y}));if(1<a.node.children.length&&this.config.displayVariations)for(var c=0;c<a.node.children.length;c++)a.node.children[c].move&&!a.node.children[c].move.pass&&
b.push({type:"LB",text:String.fromCharCode(65+c),x:a.node.children[c].move.x,y:a.node.children[c].move.y,c:this.board.theme.variationColor||"rgba(0,32,128,0.8)"});if(a.node.markup){for(c in a.node.markup)for(var e=0;e<b.length;e++)a.node.markup[c].x==b[e].x&&a.node.markup[c].y==b[e].y&&(b.splice(e,1),e--);b=b.concat(a.node.markup)}this.temp_marks=b;this.board.addObject(b);this.config.displayMoveNumbers&&this.displayMoveNumbers()},p=function(a){this.board.setSize(a.kifu.size);this.board.removeAllObjects();
this.config.enableWheel&&this.setWheel(!0)},k=function(a,b){return a==b.element||a==b.element?!1:a._wgo_scrollable||a.scrollHeight>a.offsetHeight&&"auto"==window.getComputedStyle(a).overflow?!0:k(a.parentNode,b)},c=function(a){var b=a.wheelDelta||-1*a.detail;return k(a.target,this)?!0:0>b?(this.next(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):0<b?(this.previous(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):!0},e=
function(a){if(document.querySelector("input:focus, textarea:focus"))return!0;switch(a.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&a.preventDefault&&a.preventDefault();return!this.config.lockScroll},q=function(a,b){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var c in this.kifuReader.node.children)if(this.kifuReader.node.children[c].move&&this.kifuReader.node.children[c].move.x==a&&this.kifuReader.node.children[c].move.y==b){this.next(c);
break}},g=function(a){this.config=a;for(var b in g["default"])void 0===this.config[b]&&void 0!==g["default"][b]&&(this.config[b]=g["default"][b]);this.element=document.createElement("div");this.board=new d.Board(this.element,this.config.board);this.init();this.initGame()};g.prototype={constructor:g,init:function(){this.kifu=null;this.listeners={kifuLoaded:[p.bind(this)],update:[f.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);
this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",q.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&
this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(a){this.kifuReader&&this.kifuReader.change&&(a={type:"update",op:a,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},this.dispatchEvent(a))},loadKifu:function(a,b){this.kifu=a;this.kifuReader=new d.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});
this.update("init");b&&this.goTo(b)},loadSgf:function(a,b){try{this.loadKifu(d.Kifu.fromSgf(a),b)}catch(m){this.error(m)}},loadJSON:function(a,b){try{this.loadKifu(d.Kifu.fromJGO(a),b)}catch(m){this.error(m)}},loadSgfFromFile:function(a,b){var c=this;try{l(a,function(a){c.loadSgf(a,b)})}catch(v){this.error(v)}},addEventListener:function(a,b){this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(b)},removeEventListener:function(a,b){if(this.listeners[a]){var c=this.listeners[a].indexOf(b);
-1!=c&&this.listeners[a].splice(c,1)}},dispatchEvent:function(a){if(this.listeners[a.type])for(var b in this.listeners[a.type])this.listeners[a.type][b](a)},notification:function(a){console&&a&&console.log(a)},help:function(a){console&&console.log(a)},error:function(a){if(!d.ERROR_REPORT)throw a;console&&console.log(a)},next:function(a){if(!this.frozen&&this.kifu)try{this.kifuReader.next(a),this.update()}catch(t){this.error(t)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),
this.update()}catch(a){this.error(a)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(a){this.error(a)}},first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(a){this.error(a)}},goTo:function(a){if(!this.frozen&&this.kifu){var b;"function"==typeof a&&(a=a.call(this));"number"==typeof a?(b=d.clone(this.kifuReader.path),b.m=a||0):b=a;try{this.kifuReader.goTo(b),this.update()}catch(m){this.error(m)}}},getGameInfo:function(){if(!this.kifu)return null;
var a={},b;for(b in this.kifu.info)-1!=d.Kifu.infoList.indexOf(b)&&(a[b]=d.Kifu.infoFormatters[b]?[d.t(b),d.Kifu.infoFormatters[b](this.kifu.info[b])]:[d.t(b),d.filterHTML(this.kifu.info[b])]);return a},setFrozen:function(a){this.frozen=a;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(a){document.onkeydown=a?e.bind(this):null},setWheel:function(a){!this._wheel_listener&&
a?(this._wheel_listener=c.bind(this),a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(a,this._wheel_listener)):this._wheel_listener&&!a&&(a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(a,this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(a){!this.coordinates&&a?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(d.Board.coordinates)):this.coordinates&&!a&&(this.board.setSection(0,
0,0,0),this.board.removeCustomObject(d.Board.coordinates));this.coordinates=a},displayMoveNumbers:function(){for(var a=this.kifuReader.node,b=[];;){a.move&&b.push({type:"LB",x:a.move.x,y:a.move.y});if(a.MN||!a.parent)break;a=a.parent}for(var a=a.MN?parseInt(a.MN):1,c=0;c<b.length;c++)b[b.length-1-c].text=(a+c).toString();b=b.filter(function(a){return null!=a.x&&null!=a.y});this.temp_marks=this.temp_marks.concat(b);this.board.addObject(b)}};g["default"]={sgf:void 0,json:void 0,sgfFile:void 0,move:void 0,
board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0,displayVariations:!0,displayMoveNumbers:!1};d.Player=g;var r={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},b;for(b in r)d.i18n.en[b]=r[b]})(WGo);(function(d){var h=0,l=function(c,e,d){var f={};f.element=document.createElement("div");f.element.className="wgo-player-"+c;f.wrapper=document.createElement("div");f.wrapper.className="wgo-player-"+c+"-wrapper";f.element.appendChild(f.wrapper);e.appendChild(f.element);d||(f.element.style.display="none");return f},f=function(c){var e;if(e=this.currentLayout.layout?this.currentLayout.layout[c]:this.currentLayout[c]){this.regions[c].element.style.display="block";e.constructor!=Array&&(e=[e]);for(var d in e)this.components[e[d]]||
(this.components[e[d]]=new k.component[e[d]](this)),this.components[e[d]].appendTo(this.regions[c].wrapper),this.components[e[d]]._detachFromPlayer=!1}else this.regions[c].element.style.display="none"},p=function(c){if(c.target.dataset.sgfTag){switch(c.target.dataset.sgfTag){case "C":this.kifuReader.node.comment=c.target.innerText;break;case "PB":/\r?\n/.test(c.target.innerText)&&(c.target.innerText=c.target.innerText.replace(/\r?\n/g,""));this.kifu.info.black.name=c.target.innerText;break;case "BR":/\r?\n/.test(c.target.innerText)&&
(c.target.innerText=c.target.innerText.replace(/\r?\n/g,""));this.kifu.info.black.rank=c.target.innerText;break;case "PW":/\r?\n/.test(c.target.innerText)&&(c.target.innerText=c.target.innerText.replace(/\r?\n/g,""));this.kifu.info.white.name=c.target.innerText;break;case "WR":/\r?\n/.test(c.target.innerText)&&(c.target.innerText=c.target.innerText.replace(/\r?\n/g,""));this.kifu.info.white.rank=c.target.innerText;break;default:this.kifu.info[c.target.dataset.sgfTag]=c.target.innerText}this.kifu._edited=
!0}},k=d.extendClass(d.Player,function(c,e){this.config=e;for(var f in k["default"])void 0===this.config[f]&&void 0!==k["default"][f]&&(this.config[f]=k["default"][f]);for(f in d.Player["default"])void 0===this.config[f]&&void 0!==d.Player["default"][f]&&(this.config[f]=d.Player["default"][f]);this.element=c;this.element.innerHTML="";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.addEventListener("input",function(c){this.dispatchEvent(c)}.bind(this),
!1);this.element.id||(this.element.id="wgo_"+h++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=l("left",this.element);this.element.appendChild(this.dom.center);this.regions.right=l("right",this.element);this.regions.top=l("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=l("bottom",
this.dom.center);this.board=new d.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this));this.updateDimensions();this.loadKifu(new d.Kifu,this.config.move);this.initGame();this._editable=new d.Player.Editable(this,this.board);this._editable.set(!0);this.addEventListener("input",p.bind(this))});k.prototype.appendTo=function(c){c.appendChild(this.element);this.updateDimensions()};k.prototype.updateDimensions=
function(){for(var c=window.getComputedStyle(this.element),e=[];this.element.firstChild;)e.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);for(var d=parseInt(c.width),g=parseInt(c.height),k=parseInt(c.maxHeight)||0,c=0;c<e.length;c++)this.element.appendChild(e[c]);if(d!=this.width||g!=this.height||k!=this.maxHeight){this.width=d;this.height=g;this.maxHeight=k;a:if(e=this.config.layout,e.constructor==Array){d=this.height||this.maxHeight;for(g=0;g<e.length;g++)if(!e[g].conditions||
!(e[g].conditions.minWidth&&!(e[g].conditions.minWidth<=this.width)||e[g].conditions.minHeight&&d&&!(e[g].conditions.minHeight<=d)||e[g].conditions.maxWidth&&!(e[g].conditions.maxWidth>=this.width)||e[g].conditions.maxHeight&&d&&!(e[g].conditions.maxHeight>=d)||e[g].conditions.custom&&!e[g].conditions.custom.call(this))){e=e[g];break a}e=void 0}if((this.currentLayout=e)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:
this.classes;for(var b in this.components)this.components[b]._detachFromPlayer=!0;f.call(this,"left");f.call(this,"right");f.call(this,"top");f.call(this,"bottom");for(b in this.components)this.components[b]._detachFromPlayer&&this.components[b].element.parentNode&&this.components[b].element.parentNode.removeChild(this.components[b].element);this.lastLayout=this.currentLayout}e=this.dom.board.clientWidth;(b=this.height||this.maxHeight)&&(b-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);
b&&b<e?b!=this.board.height&&this.board.setHeight(b):e!=this.board.width&&this.board.setWidth(e);e=b-e;0<e?(this.dom.board.style.height=b+"px",this.dom.board.style.paddingTop=e/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(c in this.components)this.components[c].updateDimensions&&this.components[c].updateDimensions()}};
k.prototype.showMessage=function(c,e,f){this.info_overlay=document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var g=document.createElement("div");g.className="wgo-info-message";g.innerHTML=c;c=document.createElement("div");c.className="wgo-info-close";f||(c.innerHTML=d.t("BP:closemsg"));g.appendChild(c);this.info_overlay.appendChild(g);
e?this.info_overlay.addEventListener("click",function(c){e(c)}):f||this.info_overlay.addEventListener("click",function(c){this.hideMessage()}.bind(this));this.setFrozen(!0)};k.prototype.hideMessage=function(){this.element.querySelector(".wgo-info-overlay")&&(this.element.removeChild(this.info_overlay),this.setFrozen(!1))};k.prototype.error=function(c){if(!d.ERROR_REPORT)throw c;switch(c.name){case "InvalidMoveError":this.showMessage("<h1>"+c.name+"</h1><p>"+c.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');
break;case "FileError":this.showMessage("<h1>"+c.name+"</h1><p>"+c.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+c.name+"</h1><p>"+c.message+"</p><pre>"+c.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};k.component={};k.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},
minimal:{bottom:[]}};k.dynamicLayout=[{conditions:{minWidth:650},layout:k.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:k.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:k.layouts.no_comment,className:"wgo-small"},{layout:k.layouts.no_comment,className:"wgo-xsmall"}];k["default"]={layout:k.dynamicLayout};d.i18n.en["BP:closemsg"]="click anywhere to close this window";k.attributes={"data-wgo":function(c){c&&("("==c[0]?
this.sgf=c:this.sgfFile=c)},"data-wgo-board":function(c){this.board=eval("({"+c+"})")},"data-wgo-onkifuload":function(c){this.kifuLoaded=new Function(c)},"data-wgo-onupdate":function(c){this.update=new Function(c)},"data-wgo-onfrozen":function(c){this.frozen=new Function(c)},"data-wgo-onunfrozen":function(c){this.unfrozen=new Function(c)},"data-wgo-layout":function(c){this.layout=eval("({"+c+"})")},"data-wgo-enablewheel":function(c){"false"==c.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(c){"false"==
c.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(c){"false"==c.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(c){"false"==c.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(c){"false"!=c.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(c){var e=parseInt(c);isNaN(e)?this.move=eval("({"+c+"})"):this.move=e},"data-wgo-marklastmove":function(c){"false"==c.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(c){c&&
("("==c[0]?this.sgf=c:this.sgfFile=c,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};d.BasicPlayer=k;window.addEventListener("load",function(){for(var c=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),e=0;e<c.length;e++){var d=c[e],f,h;h={};for(var b=0;b<d.attributes.length;b++)f=d.attributes[b],k.attributes[f.name]&&k.attributes[f.name].call(h,f.value,f.name);f=new k(d,h);d._wgo_player=f}})})(WGo);(function(d,h){var l=function(){this.element=document.createElement("div")};l.prototype={constructor:l,appendTo:function(d){d.appendChild(this.element)},getWidth:function(){var d=window.getComputedStyle(this.element);return parseInt(d.width)},getHeight:function(){var d=window.getComputedStyle(this.element);return parseInt(d.height)},updateDimensions:function(){}};d.BasicPlayer.component.Component=l})(WGo);(function(){var d=function(c){this[c]={};var e=this[c];e.box=document.createElement("div");e.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+c;e.name=document.createElement("div");e.name.contentEditable="true";e.name.className="wgo-box-title";e.name.dataset.sgfTag="black"==c?"PB":"PW";e.name.innerHTML=c;e.box.appendChild(e.name);var d;d=document.createElement("div");d.className="wgo-player-info";e.box.appendChild(d);e.info={};e.info.rank=h("rank","black"==c?"BR":"WR");e.info.rank.val.innerHTML=
"-";e.info.caps=h("caps");e.info.caps.val.innerHTML="0";e.info.time=h("time");e.info.time.val.innerHTML="--:--";d.appendChild(e.info.rank.wrapper);d.appendChild(e.info.caps.wrapper);d.appendChild(e.info.time.wrapper)},h=function(c,d){var e={};e.wrapper=document.createElement("div");e.wrapper.className="wgo-player-info-box-wrapper";e.box=document.createElement("div");e.box.className="wgo-player-info-box";e.wrapper.appendChild(e.box);e.title=document.createElement("div");e.title.className="wgo-player-info-title";
e.title.innerHTML=WGo.t(c);e.box.appendChild(e.title);e.val=document.createElement("div");e.val.className="wgo-player-info-value";d&&(e.val.contentEditable="true",e.val.dataset.sgfTag=d);e.box.appendChild(e.val);return e},l=function(c){c=c.kifu.info||{};c.black?(this.black.name.innerHTML=WGo.filterHTML(c.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(c.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");c.white?(this.white.name.innerHTML=
WGo.filterHTML(c.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(c.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),this.white.info.rank.val.innerHTML="-");this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";c.TM?(this.setPlayerTime("black",c.TM),this.setPlayerTime("white",c.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},f=function(c){var e,d;c.style.fontSize?(d=
parseInt(c.style.fontSize),c.style.fontSize="",e=window.getComputedStyle(c),e=parseInt(e.fontSize),c.style.fontSize=d+"px"):(e=window.getComputedStyle(c),e=d=parseInt(e.fontSize));if(!(d==e&&c.scrollHeight<=c.offsetHeight))if(c.scrollHeight>c.offsetHeight)for(d-=2;c.scrollHeight>c.offsetHeight&&1<d;)c.style.fontSize=d+"px",d-=2;else if(d<e){for(d+=2;c.scrollHeight<=c.offsetHeight&&d<=e;)c.style.fontSize=d+"px",d+=2;c.scrollHeight>c.offsetHeight&&(c.style.fontSize=d-4+"px")}},p=function(c){c.node.BL&&
this.setPlayerTime("black",c.node.BL);c.node.WL&&this.setPlayerTime("white",c.node.WL);void 0!==c.position.capCount.black&&(this.black.info.caps.val.innerHTML=c.position.capCount.black);void 0!==c.position.capCount.white&&(this.white.info.caps.val.innerHTML=c.position.capCount.white)},k=WGo.extendClass(WGo.BasicPlayer.component.Component,function(c){this["super"](c);this.element.className="wgo-infobox";d.call(this,"white");d.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box);
c.addEventListener("kifuLoaded",l.bind(this));c.addEventListener("update",p.bind(this))});k.prototype.setPlayerTime=function(c,d){var e=Math.round(d)%60;this[c].info.time.val.innerHTML=Math.floor(d/60)+":"+(10>e?"0"+e:e)};k.prototype.updateDimensions=function(){f(this.black.name);f(this.white.name)};var c=WGo.BasicPlayer.layouts;c.right_top.right.push("InfoBox");c.right.right.push("InfoBox");c.one_column.top.push("InfoBox");c.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps=
"Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=k})(WGo);(function(d,h){var l=function(c){var d,f;d=c.charCodeAt(0)-97;0>d&&(d+=32);7<d&&d--;f=c.charCodeAt(1)-48;2<c.length&&(f=10*f+(c.charCodeAt(2)-48));f=this.kifuReader.game.size-f;this._tmp_mark={type:"MA",x:d,y:f};this.board.addObject(this._tmp_mark)},f=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark},p=function(c,d){for(var e in c)c[e].className&&"wgo-move-link"==c[e].className?(c[e].addEventListener("mouseover",l.bind(d,c[e].innerHTML)),c[e].addEventListener("mouseout",f.bind(d))):
c[e].childNodes&&c[e].childNodes.length&&p(c[e].childNodes,d)},k=d.extendClass(d.BasicPlayer.component.Component,function(c){this["super"](c);this.player=c;this.element.className="wgo-commentbox";this.box=document.createElement("div");this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=d.t("comments");this.box.appendChild(this.comments_title);
this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className=
"wgo-comment-text";this.comment_text.dataset.sgfTag="C";this.comments.appendChild(this.comment_text);c.addEventListener("kifuLoaded",function(e){this.comments_title.innerHTML=d.t("comments");this.element.className="wgo-commentbox";this._update=function(c){this.setComments(c)}.bind(this);c.addEventListener("update",this._update)}.bind(this));c.notification=function(c){c?(this.notification.style.display="block",this.notification.innerHTML=c,this.is_notification=!0):(this.notification.style.display=
"none",this.is_notification=!1)}.bind(this);c.help=function(c){c?(this.help.style.display="block",this.help.innerHTML=c,this.is_help=!0):(this.help.style.display="none",this.is_help=!1)}.bind(this)});k.prototype.setComments=function(c){this.player._tmp_mark&&f.call(this.player);var e="";if(c.node.parent)this.comment_text.contentEditable="true";else{var e=c.target.getGameInfo(),k;k='<div class="wgo-info-list">'+('<div class="wgo-info-title">'+d.t("gameinfo")+"</div>");for(var g in e){var h="";/^[A-Z]{1,2}$/.test(g)&&
(h=' data-sgf-tag="'+g+'" contentEditable="true"');k+='<div class="wgo-info-item"><span class="wgo-info-label">'+e[g][0]+'</span><span class="wgo-info-value"'+h+">"+e[g][1]+"</span></div>"}e=k+"</div>";this.comment_text.contentEditable="false"}this.comment_text.innerHTML=e+this.getCommentText(c.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);this.player.config.formatMoves&&this.comment_text.childNodes&&this.comment_text.childNodes.length&&p(this.comment_text.childNodes,
this.player)};k.prototype.getCommentText=function(c,e,f){return c?(c="<p>"+d.filterHTML(c).replace(/\n/g,"</p><p>")+"</p>",e&&(c=c.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),f&&(c=c.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),c):""};d.BasicPlayer["default"].formatNicks=!0;d.BasicPlayer["default"].formatMoves=!0;d.BasicPlayer.attributes["data-wgo-formatnicks"]=function(c){"false"==c.toLowerCase()&&(this.formatNicks=
!1)};d.BasicPlayer.attributes["data-wgo-formatmoves"]=function(c){"false"==c.toLowerCase()&&(this.formatMoves=!1)};d.BasicPlayer.layouts.right_top.right.push("CommentBox");d.BasicPlayer.layouts.right.right.push("CommentBox");d.BasicPlayer.layouts.one_column.bottom.push("CommentBox");d.i18n.en.comments="Comments";d.i18n.en.gameinfo="Game info";d.BasicPlayer.component.CommentBox=k})(WGo);(function(d,h){var l=d.extendClass(d.BasicPlayer.component.Component,function(b){this["super"](b);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var a,c;for(c in l.widgets)a=new l.widgets[c].constructor(b,l.widgets[c].args),a.appendTo(this.iconBar),this.widgets.push(a)});l.prototype.updateDimensions=function(){this.element.className=340>this.element.clientWidth?
"wgo-player-control wgo-340":440>this.element.clientWidth?"wgo-player-control wgo-440":"wgo-player-control"};var f=d.BasicPlayer.control={},p=function(b){b.node.parent||this.disabled?b.node.parent&&this.disabled&&this.enable():this.disable()},k=function(b){b.node.children.length||this.disabled?b.node.children.length&&this.disabled&&this.enable():this.disable()},c=function(b){(this._disabled=this.disabled)||this.disable()},e=function(b){this._disabled||this.enable();delete this._disabled};f.Widget=
function(b,a){this.element=this.element||document.createElement(a.type||"div");this.element.className="wgo-widget-"+a.name;this.init(b,a)};f.Widget.prototype={constructor:f.Widget,init:function(b,a){a&&(a.disabled&&this.disable(),a.init&&a.init.call(this,b))},appendTo:function(b){b.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled",
"");this.element.disabled=""}};f.Group=d.extendClass(f.Widget,function(b,a){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+a.name;var c,d;for(d in a.widgets)c=new a.widgets[d].constructor(b,a.widgets[d].args),c.appendTo(this.element)});f.Clickable=d.extendClass(f.Widget,function(b,a){this["super"](b,a)});f.Clickable.prototype.init=function(b,a){var c,d=this;c=a.togglable?function(){d.disabled||(a.click.call(d,b)?d.select():d.unselect())}:function(){d.disabled||
a.click.call(d,b)};this.element.addEventListener("click",c);this.element.addEventListener("touchstart",function(b){b.preventDefault();c();a.multiple&&(d._touch_i=0,d._touch_int=window.setInterval(function(){500<d._touch_i&&c();d._touch_i+=100},100));return!1});a.multiple&&this.element.addEventListener("touchend",function(a){window.clearInterval(d._touch_int)});a.disabled&&this.disable();a.init&&a.init.call(this,b)};f.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};f.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};f.Button=d.extendClass(f.Clickable,function(b,a){var c=this.element=document.createElement("button");c.className="wgo-button wgo-button-"+a.name;c.title=d.t(a.name);this.init(b,a)});f.Button.prototype.disable=function(){f.Button.prototype["super"].prototype.disable.call(this);this.element.disabled="disabled"};f.Button.prototype.enable=
function(){f.Button.prototype["super"].prototype.enable.call(this);this.element.disabled=""};f.MenuItem=d.extendClass(f.Clickable,function(b,a){var c=this.element=document.createElement("div");c.className="wgo-menu-item wgo-menu-item-"+a.name;c.title=d.t(a.name);c.innerHTML=c.title;this.init(b,a)});f.MoveNumber=d.extendClass(f.Widget,function(b){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var a=this.move=document.createElement("input");a.type="text";
a.value="0";a.maxlength=3;a.className="wgo-player-mn-value";this.element.appendChild(a);this.element.onsubmit=a.onchange=function(a){var b=parseInt(this.getValue());for(a.goTo(b);a.kifuReader.moveNumber<b;)a.next();return!1}.bind(this,b);b.addEventListener("update",function(a){this.setValue(a.target.kifuReader.moveNumber)}.bind(this));b.addEventListener("kifuLoaded",this.enable.bind(this));b.addEventListener("frozen",this.disable.bind(this));b.addEventListener("unfrozen",this.enable.bind(this))});
f.MoveNumber.prototype.disable=function(){f.MoveNumber.prototype["super"].prototype.disable.call(this);this.move.disabled="disabled"};f.MoveNumber.prototype.enable=function(){f.MoveNumber.prototype["super"].prototype.enable.call(this);this.move.disabled=""};f.MoveNumber.prototype.setValue=function(b){this.move.value=b};f.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var q=function(b){if(b._menu_tmp)delete b._menu_tmp;else{if(!b.menu){b.menu=document.createElement("div");
b.menu.className="wgo-player-menu";b.menu.style.position="absolute";b.menu.style.display="none";this.element.parentElement.appendChild(b.menu);var a,c;for(c in l.menu)a=new l.menu[c].constructor(b,l.menu[c].args,!0),a.appendTo(b.menu)}if("none"!=b.menu.style.display)return b.menu.style.display="none",document.removeEventListener("click",b._menu_ev),delete b._menu_ev,this.unselect(),!1;b.menu.style.display="block";a=this.element.offsetTop;c=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==
b.regions.bottom.wrapper?(b.menu.style.left=c+"px",b.menu.style.top=a-b.menu.offsetHeight+1+"px"):(b.menu.style.left=c+"px",b.menu.style.top=a+this.element.offsetHeight+"px");b._menu_ev=q.bind(this,b);b._menu_tmp=!0;document.addEventListener("click",b._menu_ev);return!0}};l.menu=[{constructor:f.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(b){b.setCoordinates(!b.coordinates);return b.coordinates},init:function(b){b.coordinates&&this.select()}}}];l.widgets=[{constructor:f.Group,args:{name:"left",
widgets:[{constructor:f.Button,args:{name:"menu",togglable:!0,click:q}}]}},{constructor:f.Group,args:{name:"right",widgets:[{constructor:f.Button,args:{name:"move-number",click:function(b){b.config.displayMoveNumbers=!b.config.displayMoveNumbers;b.goTo(b.kifuReader.path)}}}]}},{constructor:f.Group,args:{name:"control",widgets:[{constructor:f.Button,args:{name:"first",disabled:!0,init:function(b){b.addEventListener("update",p.bind(this));b.addEventListener("frozen",c.bind(this));b.addEventListener("unfrozen",
e.bind(this))},click:function(b){b.first()}}},{constructor:f.Button,args:{name:"multiprev",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",p.bind(this));b.addEventListener("frozen",c.bind(this));b.addEventListener("unfrozen",e.bind(this))},click:function(b){var a=d.clone(b.kifuReader.path);a.m-=10;b.goTo(a)}}},{constructor:f.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",p.bind(this));b.addEventListener("frozen",c.bind(this));
b.addEventListener("unfrozen",e.bind(this))},click:function(b){b.previous()}}},{constructor:f.MoveNumber},{constructor:f.Button,args:{name:"next",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",c.bind(this));b.addEventListener("unfrozen",e.bind(this))},click:function(b){b.next()}}},{constructor:f.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",
c.bind(this));b.addEventListener("unfrozen",e.bind(this))},click:function(b){var a=d.clone(b.kifuReader.path);a.m+=10;b.goTo(a)}}},{constructor:f.Button,args:{name:"last",disabled:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",c.bind(this));b.addEventListener("unfrozen",e.bind(this))},click:function(b){b.last()}}}]}}];var g=d.BasicPlayer.layouts;g.right_top.top.push("Control");g.right.right.push("Control");g.one_column.top.push("Control");g.no_comment.bottom.push("Control");
g.minimal.bottom.push("Control");var g={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu","move-number":"Toggle move numbers"},r;for(r in g)d.i18n.en[r]=g[r];d.BasicPlayer.component.Control=l})(WGo);(function(d){var h=function(d,h){this.player.frozen||this._lastX==d&&this._lastY==h||(this._lastX=d,this._lastY=h,this._last_mark&&this.board.removeObject(this._last_mark),-1!=d&&-1!=h&&this.player.kifuReader.game.isValid(d,h)?(this._last_mark={type:"outline",x:d,y:h,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},l=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
d.Player.Editable={};d.Player.Editable=function(d,h){this.player=d;this.board=h;this.editMode=!1};d.Player.Editable.prototype.set=function(f){if(!this.editMode&&f)this.originalReader=this.player.kifuReader,this.player.kifuReader=new d.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||
h.bind(this),this._ev_out=this._ev_out||l.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0;else if(this.editMode&&!f){this.originalReader.goTo(this.player.kifuReader.path);f=this.originalReader;for(var p=this.player.kifuReader.getPosition(),k=this.originalReader.getPosition(),c=p.size,e=[],q=[],g=0;g<c*c;g++)p.schema[g]&&!k.schema[g]?q.push({x:Math.floor(g/c),
y:g%c}):p.schema[g]!=k.schema[g]&&e.push({x:Math.floor(g/c),y:g%c,c:k.schema[g]});f.change={add:e,remove:q};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=!1}};d.Player.Editable.prototype.play=function(f,h){if(!this.player.frozen)if(this.player.kifuReader.game.isValid(f,h))this.player.kifuReader.node.appendChild(new d.KNode({move:{x:f,
y:h,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.kifu._edited=!0,this.player.next(this.player.kifuReader.node.children.length-1);else{var k=this.player.kifuReader.node;0===k.children.length&&k.move.x===f&&k.move.y===h&&(this.player.previous(),k.remove())}};d.Player.Editable.prototype.pass=function(){this.player.frozen||(this.player.kifuReader.node.appendChild(new d.KNode({move:{pass:!0,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.kifu._edited=!0,this.player.next(this.player.kifuReader.node.children.length-
1))};d.i18n.en.editmode="Edit mode"})(WGo);(function(d){d.BasicPlayer&&d.BasicPlayer.component.Control&&d.BasicPlayer.component.Control.menu.push({constructor:d.BasicPlayer.control.MenuItem,args:{name:"play-pass",click:function(d){d._editable.pass();d.kifu._edited=!0}}});d.i18n.en["play-pass"]="Pass"})(WGo);(function(d){d.BasicPlayer&&d.BasicPlayer.component.Control&&d.BasicPlayer.component.Control.menu.push({constructor:d.BasicPlayer.control.MenuItem,args:{name:"remove-node",click:function(d){var h=d.kifuReader.node;d.previous();h.remove();d.kifu._edited=!0}}});d.i18n.en["remove-node"]="Remove a current move/node"})(WGo);(function(d){d.BasicPlayer&&d.BasicPlayer.component.Control&&d.BasicPlayer.component.Control.menu.push({constructor:d.BasicPlayer.control.MenuItem,args:{name:"insert-frame",click:function(h){if(h.kifuReader.node.FG){var l=h.kifuReader.node;h.previous();l.remove()}else h.kifuReader.node.insertAfter(new d.KNode({FG:"",MN:"1"})),h.next();h.kifu._edited=!0}}});d.i18n.en["insert-frame"]="Insert or remove frame"})(WGo);
