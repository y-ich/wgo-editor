/*! MIT license, more info: wgo.waltheri.net */(function(c,n){var h=function(b){var p=new u(JSON.parse(JSON.stringify(b.getProperties()))),a;for(a in b.children)p.appendChild(h(b.children[a]));return p},f=function(b,a){var p;if(a[b]!==n)return a[b];for(var d in a.children)if(p=f(b,a.children[d]))return p;return!1},q=function(b,a){b.push(JSON.parse(JSON.stringify(a.getProperties())));if(1<a.children.length){for(var d=[],p=0;p<a.children.length;p++){var e=[];q(e,a.children[p]);d.push(e)}b.push(d)}else a.children.length&&q(b,a.children[0])},k=function(b,
a){for(var d=a,p,e=1;e<b.length;e++)if(b[e].constructor==Array)for(var g=0;g<b[e].length;g++)p=new u(b[e][g][0]),d.appendChild(p),k(b[e][g],p);else p=new u(b[e]),d.insertAfter(p),d=p},b=function(b){return"string"==typeof b?b.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):b},a=function(b,a){return String.fromCharCode(97+b)+String.fromCharCode(97+a)},r=function(b,a,d){if(a.length){d.sgf+=b;for(var e in a)d.sgf+="["+a[e]+"]"}},g=function(d,e){if(d.move){var p="";d.move.pass||(p=a(d.move.x,d.move.y));e.sgf=
d.move.c==c.B?e.sgf+("B["+p+"]"):e.sgf+("W["+p+"]")}if(d.setup){var p=[],A=[],l=[],m;for(m in d.setup)d.setup[m].c==c.B?p.push(a(d.setup[m].x,d.setup[m].y)):d.setup[m].c==c.W?A.push(a(d.setup[m].x,d.setup[m].y)):l.push(a(d.setup[m].x,d.setup[m].y));r("AB",p,e);r("AW",A,e);r("AE",l,e)}if(d.markup){p={};for(m in d.markup)p[d.markup[m].type]=p[d.markup[m].type]||[],"LB"==d.markup[m].type?p.LB.push(a(d.markup[m].x,d.markup[m].y)+":"+b(d.markup[m].text)):p[d.markup[m].type].push(a(d.markup[m].x,d.markup[m].y));
for(var k in p)r(k,p[k],e)}m=d.getProperties();for(k in m)"object"!=typeof m[k]&&(e.sgf="turn"==k?e.sgf+("PL["+(m[k]==c.B?"B":"W")+"]"):"comment"==k?e.sgf+("C["+b(m[k])+"]"):e.sgf+(k+"["+b(m[k])+"]"));if(1==d.children.length)e.sgf+="\n;",g(d.children[0],e);else if(1<d.children.length)for(k in d.children)m=d.children[k],p=e,p.sgf+="(\n;",g(m,p),p.sgf+="\n)"},l=function(){this.size=19;this.info={};this.root=new u;this.propertyCount=this.nodeCount=0};l.prototype={constructor:l,clone:function(){var d=
new l;d.size=this.size;d.info=JSON.parse(JSON.stringify(this.info));d.root=h(this.root);d.nodeCount=this.nodeCount;d.propertyCount=this.propertyCount;return d},hasComments:function(){return!!f("comment",this.root)}};l.fromSgf=function(d){return c.SGF.parse(d)};l.fromJGO=function(d){d="string"==typeof d?JSON.parse(d):d;var b=new l;b.info=JSON.parse(JSON.stringify(d.info));b.size=d.size;b.nodeCount=d.nodeCount;b.propertyCount=d.propertyCount;b.root=new u(d.game[0]);k(d.game,b.root);return b};l.prototype.toSgf=
function(){var d={sgf:"(\n;"},a={},e;for(e in this.info)"black"==e?(this.info.black.name&&(a.PB=b(this.info.black.name)),this.info.black.rank&&(a.BR=b(this.info.black.rank)),this.info.black.team&&(a.BT=b(this.info.black.team))):"white"==e?(this.info.white.name&&(a.PW=b(this.info.white.name)),this.info.white.rank&&(a.WR=b(this.info.white.rank)),this.info.white.team&&(a.WT=b(this.info.white.team))):a[e]=b(this.info[e]);this.size&&(a.SZ=this.size);a.AP||(a.AP="WGo.js:2");a.FF||(a.FF="4");a.GM||(a.GM=
"1");a.CA||(a.CA="UTF-8");for(e in a)a[e]&&(d.sgf+=e+"["+a[e]+"]");g(this.root,d);d.sgf+=")";return d.sgf};l.prototype.toJGO=function(d){var a={};a.size=this.size;a.info=JSON.parse(JSON.stringify(this.info));a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;a.game=[];q(a.game,this.root);return d?JSON.stringify(a):a};var e=function(d){var a;d.name?(a=c.filterHTML(d.name),d.rank&&(a+=" ("+c.filterHTML(d.rank)+")"),d.team&&(a+=", "+c.filterHTML(d.team))):(d.team&&(a=c.filterHTML(d.team)),
d.rank&&(a+=" ("+c.filterHTML(d.rank)+")"));return a};l.infoFormatters={black:e,white:e,TM:function(d){if(0==d)return c.t("none");var a,b=Math.floor(d/60);1==b?a="1 "+c.t("minute"):1<b&&(a=b+" "+c.t("minutes"));b=d%60;1==b?a+=" 1 "+c.t("second"):1<b&&(a+=" "+b+" "+c.t("seconds"));return a},RE:function(d){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+c.filterHTML(d)+'\'" title="'+c.t("res-show-tip")+'">'+c.t("show")+"</a>"}};l.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");
c.Kifu=l;var d=function(d,a,b){for(var e=0;e<d.length;e++)if(d[e].x==a.x&&d[e].y==a.y){d[e][b]=a[b];return}d.push(a)},m=function(d,a){if(d)for(var b=0;b<d.length;b++)if(d[b].x==a.x&&d[b].y==a.y){d.splice(b,1);break}},u=function(d,a){this.parent=a||null;this.children=[];if(d)for(var b in d)this[b]=d[b]};u.prototype={constructor:u,getChild:function(d){d=d||0;return this.children[d]?this.children[d]:null},addSetup:function(a){this.setup=this.setup||[];d(this.setup,a,"c");return this},removeSetup:function(d){m(this.setup,
d);return this},addMarkup:function(a){this.markup=this.markup||[];d(this.markup,a,"type");return this},removeMarkup:function(d){m(this.markup,d);return this},remove:function(){var d=this.parent;if(!d)throw new Exception("Root node cannot be removed");for(var a in d.children)if(d.children[a]==this){d.children.splice(a,1);break}d.children=d.children.concat(this.children);this.parent=null;return d},insertAfter:function(d){for(var a in this.children)this.children[a].parent=d;d.children=d.children.concat(this.children);
d.parent=this;this.children=[d];return d},appendChild:function(d){d.parent=this;this.children.push(d);return d},getProperties:function(){var d={},a;for(a in this)this.hasOwnProperty(a)&&"children"!=a&&"parent"!=a&&"_"!=a[0]&&(d[a]=this[a]);return d}};c.KNode=u;var v=function(d,a){for(var b=d.size,e=[],g=[],c=0;c<b*b;c++)d.schema[c]&&!a.schema[c]?g.push({x:Math.floor(c/b),y:c%b}):d.schema[c]!=a.schema[c]&&e.push({x:Math.floor(c/b),y:c%b,c:a.schema[c]});return{add:e,remove:g}},e=function(d,a,b){this.kifu=
d;this.node=this.kifu.root;this.allow_illegal=b||!1;this.game=new c.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=c.W);this.change=w(this.game,this.node,!0);this.rememberPath=a?!0:!1},x=function(d,a){var b=[],e,g;for(g in d){e=!0;for(var c in a)if(d[g].x==a[c].x&&d[g].y==a[c].y){e=!1;break}e&&b.push(d[g])}return b},w=function(d,a,b){a.parent&&(a.parent._last_selected=a.parent.children.indexOf(a));
if(a.move!=n){if(a.move.pass)return d.pass(a.move.c),{add:[],remove:[]};d=d.play(a.move.x,a.move.y,a.move.c);if("number"==typeof d)throw new y(d,a);for(var e in d)if(d[e].x==a.move.x&&d[e].y==a.move.y)return{add:[],remove:d};return{add:[a.move],remove:d}}b||d.pushPosition();b=[];var g=[];if(a.setup!=n)for(e in a.setup)a.setup[e].c?(d.setStone(a.setup[e].x,a.setup[e].y,a.setup[e].c),b.push(a.setup[e])):(d.removeStone(a.setup[e].x,a.setup[e].y),g.push(a.setup[e]));a.turn&&(d.turn=a.turn);return{add:b,
remove:g}},z=function(d){d===n&&this.rememberPath&&(d=this.node._last_selected);d=d||0;var a=this.node.children[d];if(!a)return!1;var b=w(this.game,a);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=d);this.node=a;return b},B=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==n&&delete this.path[this.path.m];this.path.m--;return!0},C=function(){this.game.firstPosition();
this.node=this.kifu.root;this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=c.W);this.change=w(this.game,this.node,!0)};e.prototype={constructor:e,next:function(d){this.change=z.call(this,d);return this},last:function(){var d;for(this.change={add:[],remove:[]};d=z.call(this);){var a=this.change;a.add=x(a.add,d.remove).concat(d.add);a.remove=x(a.remove,d.add).concat(d.remove)}return this},previous:function(){var d=this.game.getPosition();B.call(this);this.change=v(d,this.game.getPosition());
return this},first:function(){var d=this.game.getPosition();C.call(this);this.change=v(d,this.game.getPosition());return this},goTo:function(d){if(d===n)return this;var a=this.game.getPosition();C.call(this);for(var b=0;b<d.m&&z.call(this,d[b+1]);b++);this.change=v(a,this.game.getPosition());return this},previousFork:function(){for(var d=this.game.getPosition();B.call(this)&&1==this.node.children.length;);this.change=v(d,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},
allowIllegalMoves:function(d){d?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};c.KifuReader=e;var y=function(d,a){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(a.move&&a.move.c!==n&&a.move.x!==n&&a.move.y!==n){var b=a.move.x;7<a.move.x&&b++;String.fromCharCode(b+65);this.message+="Trying to play "+(a.move.c==c.WHITE?"white":"black")+" move on "+String.fromCharCode(a.move.x+
65)+""+(19-a.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(d)switch(d){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};y.prototype=Error();y.prototype.constructor=y;c.InvalidMoveError=y;c.i18n.en.show="show";c.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(c,n){c.SGF={};var h=function(a,b,c,e,d,m){b=m==b?"black":"white";c.info[b]=c.info[b]||{};c.info[b][a]=d[0]},f=c.SGF.properties={};f.B=f.W=function(a,b,k,e){b.move=!k[0]||19>=a.size&&"tt"==k[0]?{pass:!0,c:"B"==e?c.B:c.W}:{x:k[0].charCodeAt(0)-97,y:k[0].charCodeAt(1)-97,c:"B"==e?c.B:c.W}};f.AB=f.AW=function(a,b,k,e){for(var d in k)b.addSetup({x:k[d].charCodeAt(0)-97,y:k[d].charCodeAt(1)-97,c:"AB"==e?c.B:c.W})};f.AE=function(a,b,c){for(var e in c)b.addSetup({x:c[e].charCodeAt(0)-97,y:c[e].charCodeAt(1)-
97})};f.PL=function(a,b,k){b.turn="b"==k[0]||"B"==k[0]?c.B:c.W};f.C=function(a,b,c){b.comment=c.join()};f.LB=function(a,b,c){for(var e in c)b.addMarkup({x:c[e].charCodeAt(0)-97,y:c[e].charCodeAt(1)-97,type:"LB",text:c[e].substr(3)})};f.CR=f.SQ=f.TR=f.SL=f.MA=function(a,b,c,e){for(var d in c)b.addMarkup({x:c[d].charCodeAt(0)-97,y:c[d].charCodeAt(1)-97,type:e})};f.SZ=function(a,b,c){a.size=parseInt(c[0])};f.BR=f.WR=h.bind(this,"rank","BR");f.PB=f.PW=h.bind(this,"name","PB");f.BT=f.WT=h.bind(this,"team",
"BT");f.TM=function(a,b,c,e){a.info[e]=c[0];b.BL=c[0];b.WL=c[0]};var q=/\(|\)|(;(\s*[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+)*)/g,k=/[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+/g,b=/[A-Z]+/,a=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;c.SGF.parse=function(r){var g=[],f,e,d,m=new c.Kifu,h=null;r=r.match(q);for(var n in r)if("("==r[n])g.push(h);else if(")"==r[n])h=g.pop();else{h&&m.nodeCount++;h=h?h.appendChild(new c.KNode):m.root;f=r[n].match(k)||[];m.propertyCount+=f.length;for(var x in f){d=b.exec(f[x])[0];
e=f[x].match(a);for(var w in e)e[w]=e[w].substring(1,e[w].length-1).replace(/\\(?!\\)/g,"");if(c.SGF.properties[d])c.SGF.properties[d](m,h,e,d);else 1>=e.length&&(e=e[0]),h.parent?h[d]=e:m.info[d]=e}}return m}})(WGo);(function(c){var n=function(d,a){this.name="FileError";this.message=1==a?"File '"+d+"' is empty.":2==a?"Network error. It is not possible to read '"+d+"'.":"File '"+d+"' hasn't been found on server."};n.prototype=Error();n.prototype.constructor=n;c.FileError=n;var h=c.loadFromUrl=function(d,a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status){if(0==b.responseText.length)throw new n(d,1);a(b.responseText)}else throw new n(d);};try{b.open("GET",d,!0),b.send()}catch(v){throw new n(d,
2);}},f=function(d){d.change&&this.board.update(d.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var a=[];this.notification();d.node.move&&this.config.markLastMove&&(d.node.move.pass?this.notification(c.t((d.node.move.c==c.B?"b":"w")+"pass")):a.push({type:"CR",x:d.node.move.x,y:d.node.move.y}));if(1<d.node.children.length&&this.config.displayVariations)for(var b=0;b<d.node.children.length;b++)d.node.children[b].move&&!d.node.children[b].move.pass&&a.push({type:"LB",text:String.fromCharCode(65+
b),x:d.node.children[b].move.x,y:d.node.children[b].move.y,c:this.board.theme.variationColor||"rgba(0,32,128,0.8)"});if(d.node.markup){for(b in d.node.markup)for(var e=0;e<a.length;e++)d.node.markup[b].x==a[e].x&&d.node.markup[b].y==a[e].y&&(a.splice(e,1),e--);a=a.concat(d.node.markup)}this.temp_marks=a;this.board.addObject(a)},q=function(d){this.board.setSize(d.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0)},k=function(d,a){return d==a.element||d==a.element?!1:
d._wgo_scrollable||d.scrollHeight>d.offsetHeight&&"auto"==window.getComputedStyle(d).overflow?!0:k(d.parentNode,a)},b=function(d){var a=d.wheelDelta||-1*d.detail;return k(d.target,this)?!0:0>a?(this.next(),this.config.lockScroll&&d.preventDefault&&d.preventDefault(),!this.config.lockScroll):0<a?(this.previous(),this.config.lockScroll&&d.preventDefault&&d.preventDefault(),!this.config.lockScroll):!0},a=function(d){if(document.querySelector("input:focus, textarea:focus"))return!0;switch(d.keyCode){case 39:this.next();
break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&d.preventDefault&&d.preventDefault();return!this.config.lockScroll},r=function(d,a){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var b in this.kifuReader.node.children)if(this.kifuReader.node.children[b].move&&this.kifuReader.node.children[b].move.x==d&&this.kifuReader.node.children[b].move.y==a){this.next(b);break}},g=function(d){this.config=d;for(var a in g["default"])void 0===this.config[a]&&void 0!==g["default"][a]&&
(this.config[a]=g["default"][a]);this.element=document.createElement("div");this.board=new c.Board(this.element,this.config.board);this.init();this.initGame()};g.prototype={constructor:g,init:function(){this.kifu=null;this.listeners={kifuLoaded:[q.bind(this)],update:[f.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",
this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",r.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(d){this.kifuReader&&this.kifuReader.change&&
(d={type:"update",op:d,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},this.dispatchEvent(d))},loadKifu:function(d,a){this.kifu=d;this.kifuReader=new c.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});this.update("init");a&&this.goTo(a)},loadSgf:function(a,b){try{this.loadKifu(c.Kifu.fromSgf(a),b)}catch(u){this.error(u)}},
loadJSON:function(a,b){try{this.loadKifu(c.Kifu.fromJGO(a),b)}catch(u){this.error(u)}},loadSgfFromFile:function(a,b){var d=this;try{h(a,function(a){d.loadSgf(a,b)})}catch(v){this.error(v)}},addEventListener:function(a,b){this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(b)},removeEventListener:function(a,b){if(this.listeners[a]){var d=this.listeners[a].indexOf(b);-1!=d&&this.listeners[a].splice(d,1)}},dispatchEvent:function(a){if(this.listeners[a.type])for(var d in this.listeners[a.type])this.listeners[a.type][d](a)},
notification:function(a){console&&a&&console.log(a)},help:function(a){console&&console.log(a)},error:function(a){if(!c.ERROR_REPORT)throw a;console&&console.log(a)},next:function(a){if(!this.frozen&&this.kifu)try{this.kifuReader.next(a),this.update()}catch(m){this.error(m)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(d){this.error(d)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(d){this.error(d)}},
first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(d){this.error(d)}},goTo:function(a){if(!this.frozen&&this.kifu){var d;"function"==typeof a&&(a=a.call(this));"number"==typeof a?(d=c.clone(this.kifuReader.path),d.m=a||0):d=a;try{this.kifuReader.goTo(d),this.update()}catch(u){this.error(u)}}},getGameInfo:function(){if(!this.kifu)return null;var a={},b;for(b in this.kifu.info)-1!=c.Kifu.infoList.indexOf(b)&&(a[b]=c.Kifu.infoFormatters[b]?[c.t(b),c.Kifu.infoFormatters[b](this.kifu.info[b])]:
[c.t(b),c.filterHTML(this.kifu.info[b])]);return a},setFrozen:function(a){this.frozen=a;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(d){document.onkeydown=d?a.bind(this):null},setWheel:function(a){!this._wheel_listener&&a?(this._wheel_listener=b.bind(this),a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(a,
this._wheel_listener)):this._wheel_listener&&!a&&(a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(a,this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(a){!this.coordinates&&a?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(c.Board.coordinates)):this.coordinates&&!a&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(c.Board.coordinates));this.coordinates=a}};g["default"]={sgf:void 0,json:void 0,
sgfFile:void 0,move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0,displayVariations:!0};c.Player=g;var l={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},e;for(e in l)c.i18n.en[e]=l[e]})(WGo);(function(c){var n=0,h=function(b,a,c){var g={};g.element=document.createElement("div");g.element.className="wgo-player-"+b;g.wrapper=document.createElement("div");g.wrapper.className="wgo-player-"+b+"-wrapper";g.element.appendChild(g.wrapper);a.appendChild(g.element);c||(g.element.style.display="none");return g},f=function(b){var a;if(a=this.currentLayout.layout?this.currentLayout.layout[b]:this.currentLayout[b]){this.regions[b].element.style.display="block";a.constructor!=Array&&(a=[a]);for(var c in a)this.components[a[c]]||
(this.components[a[c]]=new k.component[a[c]](this)),this.components[a[c]].appendTo(this.regions[b].wrapper),this.components[a[c]]._detachFromPlayer=!1}else this.regions[b].element.style.display="none"},q=function(b){if(b.target.dataset.sgfTag){switch(b.target.dataset.sgfTag){case "C":this.kifuReader.node.comment=b.target.innerText;break;case "PB":this.kifu.info.black.name=b.target.innerText;break;case "BR":this.kifu.info.black.rank=b.target.innerText;break;case "PW":this.kifu.info.white.name=b.target.innerText;
break;case "WR":this.kifu.info.white.rank=b.target.innerText;break;default:this.kifu.info[b.target.dataset.sgfTag]=b.target.innerText}this.kifu._edited=!0}},k=c.extendClass(c.Player,function(b,a){var r=this;this.config=a;for(var g in k["default"])void 0===this.config[g]&&void 0!==k["default"][g]&&(this.config[g]=k["default"][g]);for(g in c.Player["default"])void 0===this.config[g]&&void 0!==c.Player["default"][g]&&(this.config[g]=c.Player["default"][g]);this.element=b;this.element.innerHTML="";this.classes=
(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.addEventListener("input",function(a){this.dispatchEvent(a)}.bind(this),!1);this.element.id||(this.element.id="wgo_"+n++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=h("left",this.element);this.element.appendChild(this.dom.center);
this.regions.right=h("right",this.element);this.regions.top=h("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=h("bottom",this.dom.center);this.board=new c.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this));this.updateDimensions();this.loadKifu(new c.Kifu,this.config.move);this.initGame();this._editable=new c.Player.Editable(this,this.board);this._editable.set(!0);
this.addEventListener("input",q.bind(this));if("undefined"!=typeof nw){var f=nw.Window.get();f.on("close",function(a){r.kifu._edited&&!confirm(c.t("confirm_close"))||f.close(!0)})}});k.prototype.appendTo=function(b){b.appendChild(this.element);this.updateDimensions()};k.prototype.updateDimensions=function(){for(var b=window.getComputedStyle(this.element),a=[];this.element.firstChild;)a.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);for(var c=parseInt(b.width),g=parseInt(b.height),
k=parseInt(b.maxHeight)||0,b=0;b<a.length;b++)this.element.appendChild(a[b]);if(c!=this.width||g!=this.height||k!=this.maxHeight){this.width=c;this.height=g;this.maxHeight=k;a:if(a=this.config.layout,a.constructor==Array){c=this.height||this.maxHeight;for(g=0;g<a.length;g++)if(!a[g].conditions||!(a[g].conditions.minWidth&&!(a[g].conditions.minWidth<=this.width)||a[g].conditions.minHeight&&c&&!(a[g].conditions.minHeight<=c)||a[g].conditions.maxWidth&&!(a[g].conditions.maxWidth>=this.width)||a[g].conditions.maxHeight&&
c&&!(a[g].conditions.maxHeight>=c)||a[g].conditions.custom&&!a[g].conditions.custom.call(this))){a=a[g];break a}a=void 0}if((this.currentLayout=a)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes;for(var e in this.components)this.components[e]._detachFromPlayer=!0;f.call(this,"left");f.call(this,"right");f.call(this,"top");f.call(this,"bottom");for(e in this.components)this.components[e]._detachFromPlayer&&
this.components[e].element.parentNode&&this.components[e].element.parentNode.removeChild(this.components[e].element);this.lastLayout=this.currentLayout}a=this.dom.board.clientWidth;(e=this.height||this.maxHeight)&&(e-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);e&&e<a?e!=this.board.height&&this.board.setHeight(e):a!=this.board.width&&this.board.setWidth(a);a=e-a;0<a?(this.dom.board.style.height=e+"px",this.dom.board.style.paddingTop=a/2+"px"):(this.dom.board.style.height=
"auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(b in this.components)this.components[b].updateDimensions&&this.components[b].updateDimensions()}};k.prototype.showMessage=function(b,a,k){this.info_overlay=document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";
this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var g=document.createElement("div");g.className="wgo-info-message";g.innerHTML=b;b=document.createElement("div");b.className="wgo-info-close";k||(b.innerHTML=c.t("BP:closemsg"));g.appendChild(b);this.info_overlay.appendChild(g);a?this.info_overlay.addEventListener("click",function(b){a(b)}):k||this.info_overlay.addEventListener("click",function(a){this.hideMessage()}.bind(this));this.setFrozen(!0)};k.prototype.hideMessage=
function(){this.element.removeChild(this.info_overlay);this.setFrozen(!1)};k.prototype.error=function(b){if(!c.ERROR_REPORT)throw b;switch(b.name){case "InvalidMoveError":this.showMessage("<h1>"+b.name+"</h1><p>"+b.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');break;case "FileError":this.showMessage("<h1>"+b.name+"</h1><p>"+b.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");
break;default:this.showMessage("<h1>"+b.name+"</h1><p>"+b.message+"</p><pre>"+b.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};k.component={};k.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},minimal:{bottom:[]}};k.dynamicLayout=[{conditions:{minWidth:650},layout:k.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:k.layouts.one_column,
className:"wgo-medium"},{conditions:{minWidth:350},layout:k.layouts.no_comment,className:"wgo-small"},{layout:k.layouts.no_comment,className:"wgo-xsmall"}];k["default"]={layout:k.dynamicLayout};c.i18n.en["BP:closemsg"]="click anywhere to close this window";k.attributes={"data-wgo":function(b){b&&("("==b[0]?this.sgf=b:this.sgfFile=b)},"data-wgo-board":function(b){this.board=eval("({"+b+"})")},"data-wgo-onkifuload":function(b){this.kifuLoaded=new Function(b)},"data-wgo-onupdate":function(b){this.update=
new Function(b)},"data-wgo-onfrozen":function(b){this.frozen=new Function(b)},"data-wgo-onunfrozen":function(b){this.unfrozen=new Function(b)},"data-wgo-layout":function(b){this.layout=eval("({"+b+"})")},"data-wgo-enablewheel":function(b){"false"==b.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(b){"false"==b.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(b){"false"==b.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(b){"false"==b.toLowerCase()&&
(this.rememberPath=!1)},"data-wgo-allowillegal":function(b){"false"!=b.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(b){var a=parseInt(b);isNaN(a)?this.move=eval("({"+b+"})"):this.move=a},"data-wgo-marklastmove":function(b){"false"==b.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(b){b&&("("==b[0]?this.sgf=b:this.sgfFile=b,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};c.BasicPlayer=k;window.addEventListener("load",
function(){for(var b=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),a=0;a<b.length;a++){var c=b[a],g,f;f={};for(var e=0;e<c.attributes.length;e++)g=c.attributes[e],k.attributes[g.name]&&k.attributes[g.name].call(f,g.value,g.name);g=new k(c,f);c._wgo_player=g}})})(WGo);(function(c,n){var h=function(){this.element=document.createElement("div")};h.prototype={constructor:h,appendTo:function(c){c.appendChild(this.element)},getWidth:function(){var c=window.getComputedStyle(this.element);return parseInt(c.width)},getHeight:function(){var c=window.getComputedStyle(this.element);return parseInt(c.height)},updateDimensions:function(){}};c.BasicPlayer.component.Component=h})(WGo);(function(){var c=function(a){this[a]={};var b=this[a];b.box=document.createElement("div");b.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+a;b.name=document.createElement("div");b.name.contentEditable="true";b.name.className="wgo-box-title";b.name.dataset.sgfTag="black"==a?"PB":"PW";b.name.innerHTML=a;b.box.appendChild(b.name);var c;c=document.createElement("div");c.className="wgo-player-info";b.box.appendChild(c);b.info={};sgf_tag="black"==a?"BR":"WR";b.info.rank=n("rank",sgf_tag);b.info.rank.val.innerHTML=
"-";b.info.caps=n("caps");b.info.caps.val.innerHTML="0";b.info.time=n("time");b.info.time.val.innerHTML="--:--";c.appendChild(b.info.rank.wrapper);c.appendChild(b.info.caps.wrapper);c.appendChild(b.info.time.wrapper)},n=function(a,b){var c={};c.wrapper=document.createElement("div");c.wrapper.className="wgo-player-info-box-wrapper";c.box=document.createElement("div");c.box.className="wgo-player-info-box";c.wrapper.appendChild(c.box);c.title=document.createElement("div");c.title.className="wgo-player-info-title";
c.title.innerHTML=WGo.t(a);c.box.appendChild(c.title);c.val=document.createElement("div");c.val.className="wgo-player-info-value";b&&(c.val.contentEditable="true",c.val.dataset.sgfTag=b);c.box.appendChild(c.val);return c},h=function(a){a=a.kifu.info||{};a.black?(this.black.name.innerHTML=WGo.filterHTML(a.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(a.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");a.white?(this.white.name.innerHTML=
WGo.filterHTML(a.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(a.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),this.white.info.rank.val.innerHTML="-");this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";a.TM?(this.setPlayerTime("black",a.TM),this.setPlayerTime("white",a.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},f=function(a){var b,c;a.style.fontSize?(c=
parseInt(a.style.fontSize),a.style.fontSize="",b=window.getComputedStyle(a),b=parseInt(b.fontSize),a.style.fontSize=c+"px"):(b=window.getComputedStyle(a),b=c=parseInt(b.fontSize));if(!(c==b&&a.scrollHeight<=a.offsetHeight))if(a.scrollHeight>a.offsetHeight)for(c-=2;a.scrollHeight>a.offsetHeight&&1<c;)a.style.fontSize=c+"px",c-=2;else if(c<b){for(c+=2;a.scrollHeight<=a.offsetHeight&&c<=b;)a.style.fontSize=c+"px",c+=2;a.scrollHeight>a.offsetHeight&&(a.style.fontSize=c-4+"px")}},q=function(a){a.node.BL&&
this.setPlayerTime("black",a.node.BL);a.node.WL&&this.setPlayerTime("white",a.node.WL);void 0!==a.position.capCount.black&&(this.black.info.caps.val.innerHTML=a.position.capCount.black);void 0!==a.position.capCount.white&&(this.white.info.caps.val.innerHTML=a.position.capCount.white)},k=WGo.extendClass(WGo.BasicPlayer.component.Component,function(a){this["super"](a);this.element.className="wgo-infobox";c.call(this,"white");c.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box);
a.addEventListener("kifuLoaded",h.bind(this));a.addEventListener("update",q.bind(this))});k.prototype.setPlayerTime=function(a,b){var c=Math.round(b)%60;this[a].info.time.val.innerHTML=Math.floor(b/60)+":"+(10>c?"0"+c:c)};k.prototype.updateDimensions=function(){f(this.black.name);f(this.white.name)};var b=WGo.BasicPlayer.layouts;b.right_top.right.push("InfoBox");b.right.right.push("InfoBox");b.one_column.top.push("InfoBox");b.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps=
"Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=k})(WGo);(function(c,n){var h=function(b){var a,c;a=b.charCodeAt(0)-97;0>a&&(a+=32);7<a&&a--;c=b.charCodeAt(1)-48;2<b.length&&(c=10*c+(b.charCodeAt(2)-48));c=this.kifuReader.game.size-c;this._tmp_mark={type:"MA",x:a,y:c};this.board.addObject(this._tmp_mark)},f=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark},q=function(b,a){for(var c in b)b[c].className&&"wgo-move-link"==b[c].className?(b[c].addEventListener("mouseover",h.bind(a,b[c].innerHTML)),b[c].addEventListener("mouseout",f.bind(a))):
b[c].childNodes&&b[c].childNodes.length&&q(b[c].childNodes,a)},k=c.extendClass(c.BasicPlayer.component.Component,function(b){this["super"](b);this.player=b;this.element.className="wgo-commentbox";this.box=document.createElement("div");this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=c.t("comments");this.box.appendChild(this.comments_title);
this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className=
"wgo-comment-text";this.comment_text.dataset.sgfTag="C";this.comments.appendChild(this.comment_text);b.addEventListener("kifuLoaded",function(a){this.comments_title.innerHTML=c.t("comments");this.element.className="wgo-commentbox";this._update=function(a){this.setComments(a)}.bind(this);b.addEventListener("update",this._update)}.bind(this));b.notification=function(a){a?(this.notification.style.display="block",this.notification.innerHTML=a,this.is_notification=!0):(this.notification.style.display=
"none",this.is_notification=!1)}.bind(this);b.help=function(a){a?(this.help.style.display="block",this.help.innerHTML=a,this.is_help=!0):(this.help.style.display="none",this.is_help=!1)}.bind(this)});k.prototype.setComments=function(b){this.player._tmp_mark&&f.call(this.player);var a="";if(b.node.parent)this.comment_text.contentEditable="true";else{var a=b.target.getGameInfo(),k;k='<div class="wgo-info-list">'+('<div class="wgo-info-title" contentEditable="true">'+c.t("gameinfo")+"</div>");for(var g in a){var h=
"";/^[A-Z]{1,2}$/.test(g)&&(h=' data-sgf-tag="'+g+'" contentEditable="true"');k+='<div class="wgo-info-item"><span class="wgo-info-label">'+a[g][0]+'</span><span class="wgo-info-value"'+h+">"+a[g][1]+"</span></div>"}a=k+"</div>";this.comment_text.contentEditable="false"}this.comment_text.innerHTML=a+this.getCommentText(b.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);this.player.config.formatMoves&&this.comment_text.childNodes&&this.comment_text.childNodes.length&&q(this.comment_text.childNodes,
this.player)};k.prototype.getCommentText=function(b,a,k){return b?(b="<p>"+c.filterHTML(b).replace(/\n/g,"</p><p>")+"</p>",a&&(b=b.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),k&&(b=b.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),b):""};c.BasicPlayer["default"].formatNicks=!0;c.BasicPlayer["default"].formatMoves=!0;c.BasicPlayer.attributes["data-wgo-formatnicks"]=function(b){"false"==b.toLowerCase()&&(this.formatNicks=
!1)};c.BasicPlayer.attributes["data-wgo-formatmoves"]=function(b){"false"==b.toLowerCase()&&(this.formatMoves=!1)};c.BasicPlayer.layouts.right_top.right.push("CommentBox");c.BasicPlayer.layouts.right.right.push("CommentBox");c.BasicPlayer.layouts.one_column.bottom.push("CommentBox");c.i18n.en.comments="Comments";c.i18n.en.gameinfo="Game info";c.BasicPlayer.component.CommentBox=k})(WGo);(function(c,n){var h=c.extendClass(c.BasicPlayer.component.Component,function(a){this["super"](a);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var b,c;for(c in h.widgets)b=new h.widgets[c].constructor(a,h.widgets[c].args),b.appendTo(this.iconBar),this.widgets.push(b)});h.prototype.updateDimensions=function(){this.element.className=340>this.element.clientWidth?
"wgo-player-control wgo-340":440>this.element.clientWidth?"wgo-player-control wgo-440":"wgo-player-control"};var f=c.BasicPlayer.control={},q=function(a){a.node.parent||this.disabled?a.node.parent&&this.disabled&&this.enable():this.disable()},k=function(a){a.node.children.length||this.disabled?a.node.children.length&&this.disabled&&this.enable():this.disable()},b=function(a){(this._disabled=this.disabled)||this.disable()},a=function(a){this._disabled||this.enable();delete this._disabled};f.Widget=
function(a,b){this.element=this.element||document.createElement(b.type||"div");this.element.className="wgo-widget-"+b.name;this.init(a,b)};f.Widget.prototype={constructor:f.Widget,init:function(a,b){b&&(b.disabled&&this.disable(),b.init&&b.init.call(this,a))},appendTo:function(a){a.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled",
"");this.element.disabled=""}};f.Group=c.extendClass(f.Widget,function(a,b){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+b.name;var d,c;for(c in b.widgets)d=new b.widgets[c].constructor(a,b.widgets[c].args),d.appendTo(this.element)});f.Clickable=c.extendClass(f.Widget,function(a,b){this["super"](a,b)});f.Clickable.prototype.init=function(a,b){var d,c=this;d=b.togglable?function(){c.disabled||(b.click.call(c,a)?c.select():c.unselect())}:function(){c.disabled||
b.click.call(c,a)};this.element.addEventListener("click",d);this.element.addEventListener("touchstart",function(a){a.preventDefault();d();b.multiple&&(c._touch_i=0,c._touch_int=window.setInterval(function(){500<c._touch_i&&d();c._touch_i+=100},100));return!1});b.multiple&&this.element.addEventListener("touchend",function(a){window.clearInterval(c._touch_int)});b.disabled&&this.disable();b.init&&b.init.call(this,a)};f.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};f.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};f.Button=c.extendClass(f.Clickable,function(a,b){var d=this.element=document.createElement("button");d.className="wgo-button wgo-button-"+b.name;d.title=c.t(b.name);this.init(a,b)});f.Button.prototype.disable=function(){f.Button.prototype["super"].prototype.disable.call(this);this.element.disabled="disabled"};f.Button.prototype.enable=
function(){f.Button.prototype["super"].prototype.enable.call(this);this.element.disabled=""};f.MenuItem=c.extendClass(f.Clickable,function(a,b){var d=this.element=document.createElement("div");d.className="wgo-menu-item wgo-menu-item-"+b.name;d.title=c.t(b.name);d.innerHTML=d.title;this.init(a,b)});f.MoveNumber=c.extendClass(f.Widget,function(a){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var b=this.move=document.createElement("input");b.type="text";
b.value="0";b.maxlength=3;b.className="wgo-player-mn-value";this.element.appendChild(b);this.element.onsubmit=b.onchange=function(a){a.goTo(this.getValue());return!1}.bind(this,a);a.addEventListener("update",function(a){this.setValue(a.path.m)}.bind(this));a.addEventListener("kifuLoaded",this.enable.bind(this));a.addEventListener("frozen",this.disable.bind(this));a.addEventListener("unfrozen",this.enable.bind(this))});f.MoveNumber.prototype.disable=function(){f.MoveNumber.prototype["super"].prototype.disable.call(this);
this.move.disabled="disabled"};f.MoveNumber.prototype.enable=function(){f.MoveNumber.prototype["super"].prototype.enable.call(this);this.move.disabled=""};f.MoveNumber.prototype.setValue=function(a){this.move.value=a};f.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var r=function(a){if(a._menu_tmp)delete a._menu_tmp;else{if(!a.menu){a.menu=document.createElement("div");a.menu.className="wgo-player-menu";a.menu.style.position="absolute";a.menu.style.display="none";this.element.parentElement.appendChild(a.menu);
var b,c;for(c in h.menu)b=new h.menu[c].constructor(a,h.menu[c].args,!0),b.appendTo(a.menu)}if("none"!=a.menu.style.display)return a.menu.style.display="none",document.removeEventListener("click",a._menu_ev),delete a._menu_ev,this.unselect(),!1;a.menu.style.display="block";b=this.element.offsetTop;c=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==a.regions.bottom.wrapper?(a.menu.style.left=c+"px",a.menu.style.top=b-a.menu.offsetHeight+1+"px"):(a.menu.style.left=
c+"px",a.menu.style.top=b+this.element.offsetHeight+"px");a._menu_ev=r.bind(this,a);a._menu_tmp=!0;document.addEventListener("click",a._menu_ev);return!0}};h.menu=[{constructor:f.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(a){a.setCoordinates(!a.coordinates);return a.coordinates},init:function(a){a.coordinates&&this.select()}}}];h.widgets=[{constructor:f.Group,args:{name:"left",widgets:[{constructor:f.Button,args:{name:"menu",togglable:!0,click:r}}]}},{constructor:f.Group,args:{name:"right",
widgets:[{constructor:f.Button,args:{name:"about",click:function(a){a.showMessage(c.t("about-text"))}}}]}},{constructor:f.Group,args:{name:"control",widgets:[{constructor:f.Button,args:{name:"first",disabled:!0,init:function(c){c.addEventListener("update",q.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){a.first()}}},{constructor:f.Button,args:{name:"multiprev",disabled:!0,multiple:!0,init:function(c){c.addEventListener("update",
q.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){var b=c.clone(a.kifuReader.path);b.m-=10;a.goTo(b)}}},{constructor:f.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(c){c.addEventListener("update",q.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){a.previous()}}},{constructor:f.MoveNumber},{constructor:f.Button,args:{name:"next",disabled:!0,multiple:!0,
init:function(c){c.addEventListener("update",k.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){a.next()}}},{constructor:f.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(c){c.addEventListener("update",k.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){var b=c.clone(a.kifuReader.path);b.m+=10;a.goTo(b)}}},{constructor:f.Button,args:{name:"last",
disabled:!0,init:function(c){c.addEventListener("update",k.bind(this));c.addEventListener("frozen",b.bind(this));c.addEventListener("unfrozen",a.bind(this))},click:function(a){a.last()}}}]}}];var g=c.BasicPlayer.layouts;g.right_top.top.push("Control");g.right.right.push("Control");g.one_column.top.push("Control");g.no_comment.bottom.push("Control");g.minimal.bottom.push("Control");var g={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",
last:"Last","switch-coo":"Display coordinates",menu:"Menu"},l;for(l in g)c.i18n.en[l]=g[l];c.BasicPlayer.component.Control=h})(WGo);(function(c){var n=function(c,h){this.player.frozen||this._lastX==c&&this._lastY==h||(this._lastX=c,this._lastY=h,this._last_mark&&this.board.removeObject(this._last_mark),-1!=c&&-1!=h&&this.player.kifuReader.game.isValid(c,h)?(this._last_mark={type:"outline",x:c,y:h,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},h=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
c.Player.Editable={};c.Player.Editable=function(c,h){this.player=c;this.board=h;this.editMode=!1};c.Player.Editable.prototype.set=function(f){if(!this.editMode&&f)this.originalReader=this.player.kifuReader,this.player.kifuReader=new c.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||
n.bind(this),this._ev_out=this._ev_out||h.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0;else if(this.editMode&&!f){this.originalReader.goTo(this.player.kifuReader.path);f=this.originalReader;for(var q=this.player.kifuReader.getPosition(),k=this.originalReader.getPosition(),b=q.size,a=[],r=[],g=0;g<b*b;g++)q.schema[g]&&!k.schema[g]?r.push({x:Math.floor(g/b),
y:g%b}):q.schema[g]!=k.schema[g]&&a.push({x:Math.floor(g/b),y:g%b,c:k.schema[g]});f.change={add:a,remove:r};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=!1}};c.Player.Editable.prototype.play=function(f,h){!this.player.frozen&&this.player.kifuReader.game.isValid(f,h)&&(this.player.kifuReader.node.appendChild(new c.KNode({move:{x:f,
y:h,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.kifu._edited=!0,this.player.next(this.player.kifuReader.node.children.length-1))};c.i18n.en.editmode="Edit mode"})(WGo);(function(c){var n=function(c,b,a,f){this.originalPosition=c;this.position=c.clone();this.board=b;this.komi=a;this.output=f},h=n.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},f=function(c,b,a,h,g){var k=c.get(b,a);void 0!==k&&k!=h&&k!=g&&(c.set(b,a,h),f(c,b-1,a,h,g),f(c,b,a-1,h,g),f(c,b+1,a,h,g),f(c,b,a+1,h,g))},q=function(c,b,a,f,g){var k=b.get(a,f);c.get(a,f)!=k&&(c.set(a,f,k),q(c,b,a-1,f,g),q(c,b,a,f-1,g),q(c,b,a+
1,f,g),q(c,b,a,f+1,g))};n.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(k,b){var a=this.originalPosition.get(k,b);a==c.W?this.position.get(k,b)==h.WHITE_STONE?f(this.position,k,b,h.BLACK_CANDIDATE,h.BLACK_STONE):(q(this.position,this.originalPosition,k,b,h.BLACK_STONE),this.calculate()):a==c.B?this.position.get(k,b)==h.BLACK_STONE?f(this.position,k,b,h.WHITE_CANDIDATE,h.WHITE_STONE):(q(this.position,this.originalPosition,
k,b,h.WHITE_STONE),this.calculate()):(a=this.position.get(k,b),a==h.BLACK_CANDIDATE?this.position.set(k,b,h.BLACK_NEUTRAL):a==h.WHITE_CANDIDATE?this.position.set(k,b,h.WHITE_NEUTRAL):a==h.BLACK_NEUTRAL?this.position.set(k,b,h.BLACK_CANDIDATE):a==h.WHITE_NEUTRAL&&this.position.set(k,b,h.WHITE_CANDIDATE));this.board.restoreState({objects:c.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};n.prototype.end=function(){this.board.restoreState({objects:c.clone(this.saved_state.objects)});
this.board.removeEventListener("click",this._click)};n.prototype.displayScore=function(){for(var k=[],b=[],a=[],f=[],g=[],l=0;l<this.position.size;l++)for(var e=0;e<this.position.size;e++)s=this.position.get(l,e),t=this.originalPosition.get(l,e),s==h.BLACK_CANDIDATE?k.push({x:l,y:e,type:"mini",c:c.B}):s==h.WHITE_CANDIDATE?b.push({x:l,y:e,type:"mini",c:c.W}):s==h.NEUTRAL&&a.push({x:l,y:e}),t==c.W&&s!=h.WHITE_STONE?g.push({x:l,y:e,type:"outline",c:c.W}):t==c.B&&s!=h.BLACK_STONE&&f.push({x:l,y:e,type:"outline",
c:c.B});for(l=0;l<f.length;l++)this.board.removeObjectsAt(f[l].x,f[l].y);for(l=0;l<g.length;l++)this.board.removeObjectsAt(g[l].x,g[l].y);this.board.addObject(g);this.board.addObject(f);this.board.addObject(k);this.board.addObject(b);a="<p style='font-weight: bold;'>"+c.t("RE")+"</p>";l=k.length+g.length+this.originalPosition.capCount.black;e=b.length+f.length+this.originalPosition.capCount.white+parseFloat(this.komi);a+="<p>"+c.t("black")+": "+k.length+" + "+(g.length+this.originalPosition.capCount.black)+
" = "+l+"</br>";a+=c.t("white")+": "+b.length+" + "+(f.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+e+"</p>";a=l>e?a+("<p style='font-weight: bold;'>"+c.t("bwin",l-e)+"</p>"):a+("<p style='font-weight: bold;'>"+c.t("wwin",e-l)+"</p>");this.output(a)};n.prototype.calculate=function(){var c,b,a,f,g,l;c=this.position;for(l=!0;l;){l=!1;for(var e=0;e<c.size;e++)for(var d=0;d<c.size;d++)if(b=c.get(d,e),b==h.UNKNOWN||b==h.BLACK_CANDIDATE||b==h.WHITE_CANDIDATE){a=[c.get(d-1,e),c.get(d,
e-1),c.get(d+1,e),c.get(d,e+1)];g=f=!1;for(var m=0;4>m;m++)a[m]==h.BLACK_STONE||a[m]==h.BLACK_CANDIDATE?f=!0:a[m]==h.WHITE_STONE||a[m]==h.WHITE_CANDIDATE?g=!0:a[m]==h.NEUTRAL&&(g=f=!0);a=!1;f&&g?a=h.NEUTRAL:f?a=h.BLACK_CANDIDATE:g&&(a=h.WHITE_CANDIDATE);a&&b!=a&&(l=!0,c.set(d,e,a))}}};c.ScoreMode=n;c.BasicPlayer&&c.BasicPlayer.component.Control&&c.BasicPlayer.component.Control.menu.push({constructor:c.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:!0,click:function(f){if(this.selected)return f.setFrozen(!1),
this._score_mode.end(),delete this._score_mode,f.notification(),f.help(),!1;f.setFrozen(!0);f.help("<p>"+c.t("help_score")+"</p>");this._score_mode=new c.ScoreMode(f.kifuReader.game.position,f.board,f.kifu.info.KM||.5,f.notification);this._score_mode.start();return!0}}});c.i18n.en.scoremode="Count score";c.i18n.en.score="Score";c.i18n.en.bwin="Black wins by $ points.";c.i18n.en.wwin="White wins by $ points.";c.i18n.en.help_score="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(c,n){var h={active:!0,query:{}},f=function(c){try{h.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(b){h.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&h.active){f();for(var c in h.query){var b=document.getElementById(c);b&&b._wgo_player&&b._wgo_player.goTo(q)}}});window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&h.active&&f()});window.addEventListener("load",function(){if(""!=window.location.hash&&
h.active)for(var c in h.query){var b=document.getElementById(c);if(b&&b._wgo_player){b.scrollIntoView();break}}});var q=function(){if(h.query[this.element.id])return h.query[this.element.id]["goto"]};c.Player["default"].move=q;c.BasicPlayer&&c.BasicPlayer.component.Control&&c.BasicPlayer.component.Control.menu.push({constructor:c.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(f){var b=location.href.split("#")[0]+"#"+f.element.id+'={"goto":'+JSON.stringify(f.kifuReader.path)+"}";
f.showMessage("<h1>"+c.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+b+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}});c.Player.permalink=h;c.i18n.en.permalink="Permanent link"})(WGo);
